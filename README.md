# go-clean-starter

[ğŸ‡¯ğŸ‡µ **æ—¥æœ¬èª**](./README_JA.md)

This is a Go template of clean architecture to ease and boost up a backend development with up to date libraries utilizing clean architecture as design.

## Requirements
| Name | Used for |
|-|-|
| [Go](https://go.dev/) | for backend application |
| [Docker and docker-compose](https://www.docker.com/) | for containers |
| [goimports](https://pkg.go.dev/golang.org/x/tools/cmd/goimports) | for formatting source code |
| [golangci-lint](https://github.com/golangci/golangci-lint) | for linting source code |

## Overview
This app has three containers.
- `api` to run api server
- `task` to run task
- `postgres` for database

### Architecture

```txt
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Docker Compose Project           â”‚
â”‚                                            â”‚
â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚    â”‚     API      â”‚   â”‚   Task-Runner  â”‚   â”‚
â”‚    â”‚    (HTTP)    â”‚   â”‚   (CLI Tasks)  â”‚   â”‚
â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚            â”‚                  â”‚            â”‚
â”‚            â–¼                  â–¼            â”‚
â”‚     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚     â”‚          PostgreSQL DB         â”‚     â”‚
â”‚     â”‚     (go_clean_starter DB)      â”‚     â”‚
â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

```

### Key Technologies
- **Go**: Primary language for high performance, simplicity, and strong concurrency support
- **Echo**: Fast and lightweight HTTP web framework with clean routing and rich middleware support
- **PostgreSQL**: Reliable database with advanced features like JSONB, full-text search, and strong consistency
- **sqlc**: Generates type-safe Go code from raw SQL queries for compile-time safety and better performance
- **golang-migrate**: Handles database schema migrations with version control, locking, and rollback support
- **oapi-codegen**: Generates Go structs and types from OpenAPI specifications for type-safe API development
- **Wire**: Compile-time dependency injection for clean, type-safe, and maintainable object initialization
- **Air**: Hot reload tool for fast development cycles with automatic rebuilds on file changes
- **Docker & Docker Compose**: Containerization for consistent development and deployment environments

### Directory structure

```bash
go-clean-starter
â”œâ”€â”€ builder
â”‚   â”œâ”€â”€ dependency.go
â”‚   â”œâ”€â”€ wire.go         # manually written wire code
â”‚   â””â”€â”€ wire_gen.go     # wire code auto generated by `wire.go`
â”œâ”€â”€ cmd
â”‚   â”œâ”€â”€ migration.go    # command to run migration
â”‚   â”œâ”€â”€ serve.go        # command to run API server
â”‚   â””â”€â”€ task.go         # commands to run tasks (currently only one task is defined here)
â”œâ”€â”€ config
â”œâ”€â”€ domain # domain models
â”œâ”€â”€ go.sum
â”œâ”€â”€ internal
â”‚   â”œâ”€â”€ http # http layer
â”‚   â”‚   â”œâ”€â”€ base
â”‚   â”‚   â”œâ”€â”€ handler
â”‚   â”‚   â”‚   â”œâ”€â”€ errors.go
â”‚   â”‚   â”‚   â”œâ”€â”€ openapi_types.gen.go # auto generated Go structs by doc/api.yaml
â”‚   â”‚   â”‚   â””â”€â”€ user
â”‚   â”‚   â”œâ”€â”€ middleware
â”‚   â”‚   â””â”€â”€ server.go
â”‚   â”œâ”€â”€ repository # data access layer
â”‚   â”‚   â”œâ”€â”€ item
â”‚   â”‚   â”œâ”€â”€ user
â”‚   â”‚   â””â”€â”€ transaction.go
â”‚   â”œâ”€â”€ service # business logic layer
â”‚   â”‚   â””â”€â”€ user
â”‚   â”œâ”€â”€ sqlc # sqlc input & output
â”‚   â”‚   â”œâ”€â”€ query
â”‚   â”‚   â”‚   â”œâ”€â”€ items.sql
â”‚   â”‚   â”‚   â””â”€â”€ users.sql
â”‚   â”‚   â”œâ”€â”€ db.go
â”‚   â”‚   â”œâ”€â”€ items.sql.go
â”‚   â”‚   â”œâ”€â”€ models.go
â”‚   â”‚   â””â”€â”€ users.sql.go
â”‚   â””â”€â”€ task # task program such as job, batch, etc...
â”‚       â””â”€â”€ item
â”‚           â”œâ”€â”€ data
â”‚           â”‚   â””â”€â”€ item.csv
â”‚           â”œâ”€â”€ item.go
â”‚           â””â”€â”€ usecase.go
â”œâ”€â”€ main.go
â”œâ”€â”€ migration
â”‚   â”œâ”€â”€ migrate.go
â”‚   â””â”€â”€ sql # migration sql files
â”œâ”€â”€ pkg                         # pkg is empty now. add packages that can be imported by other projects
â”œâ”€â”€ README.md
â”œâ”€â”€ WHY.md                      # document to explain why this tech stack and tech specifications are choosen
â”œâ”€â”€ docker-compose.test.yaml
â”œâ”€â”€ docker-compose.yaml
â””â”€â”€ sqlc.yaml                    # configuration of sqlc
```

## Setup

### Setup environment values
- create `.env` by copying `.env.sample`
```bash
cp .env.sample .env
```

### Docker
- run `make build` to build Docker images
```bash
make build
```

- run `make up` to create and run Docker containers by docker-compose
```bash
make up
```

ğŸ’¡ This project uses **[air](https://github.com/air-verse/air)**, which is Go hot reload. Hot reload helps us to develop faster.

## Test
- run `make test` to test
`make test` will create a test environment using the test specific [docker-compose.test.yaml](./docker-compose.test.yaml) with the same [Dockerfile](./Dockerfile) as development.
Thus safety of test environment is assured as it's separated from local environment for development.

```bash
make test
```

## API Usage

Once the server is running, you can interact with the API:

ğŸ“‹ **Complete API documentation is available in [`api.yaml`](./api.yaml)** - OpenAPI 3.1 specification with all endpoints, schemas, and examples.

### Health Check
```bash
curl http://localhost:8080/health
```

### Getting Help
- Check [Issues](https://github.com/SoraDaibu/go-clean-starter/issues) for known problems
- Review [WHY.md](./WHY.md) for architecture decisions

## Contributions
read [CONTRIUTING.md](./CONTRIBUTING.md) to contribute to this project.
